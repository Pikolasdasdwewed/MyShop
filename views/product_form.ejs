<%- include('partials/header', { title: (product ? 'Редактировать монитор' : 'Добавить монитор') }) %>

<h1 class="h4 mb-3">
  <%= product ? 'Редактировать монитор' : 'Добавить монитор' %>
</h1>

<form method="post" action="<%= product ? ('/products/' + product.id) : '/products' %>">
  <div class="row g-3">

    <!-- Бренд -->
    <div class="col-6">
      <label class="form-label" for="brand">Бренд</label>
      <input 
        class="form-control" 
        id="brand" 
        name="brand" 
        required
        value="<%= product ? product.brand : '' %>"
      >
    </div>

    <!-- Модель -->
    <div class="col-6">
      <label class="form-label" for="model">Модель</label>
      <input 
        class="form-control" 
        id="model" 
        name="model" 
        required
        value="<%= product ? product.model : '' %>"
      >
    </div>

    <!-- Диагональ -->
    <div class="col-6">
      <label class="form-label" for="diagonal">Диагональ (дюймы)</label>
      <input 
        class="form-control" 
        type="number" 
        step="0.1" 
        id="diagonal" 
        name="diagonal" 
        required
        value="<%= product ? product.diagonal : '' %>"
      >
    </div>

    <!-- Разрешение -->
    <div class="col-6">
      <label class="form-label" for="resolution">Разрешение</label>
      <input 
        class="form-control" 
        id="resolution" 
        name="resolution" 
        required
        value="<%= product ? product.resolution : '' %>"
      >
    </div>

    <!-- Тип матрицы -->
    <div class="col-6">
      <label class="form-label" for="panelType">Тип матрицы</label>
      <select class="form-select" id="panelType" name="panelType" required>
        <% const types = ["IPS", "VA", "TN", "OLED", "MiniLED"]; %>
        <% types.forEach(t => { %>
          <option value="<%= t %>" <%= product && product.panelType === t ? 'selected' : '' %>><%= t %></option>
        <% }) %>
      </select>
    </div>

    <!-- Частота обновления -->
    <div class="col-6">
      <label class="form-label" for="refreshRate">Частота (Hz)</label>
      <input 
        class="form-control" 
        type="number" 
        id="refreshRate" 
        name="refreshRate" 
        required
        value="<%= product ? product.refreshRate : '' %>"
      >
    </div>

    <!-- Время отклика -->
    <div class="col-6">
      <label class="form-label" for="responseTime">Время отклика (ms)</label>
      <input 
        class="form-control" 
        type="number" 
        step="0.1" 
        id="responseTime" 
        name="responseTime" 
        required
        value="<%= product ? product.responseTime : '' %>"
      >
    </div>

    <!-- Порты -->
    <div class="col-6">
      <label class="form-label" for="ports">Порты</label>
      <input 
        class="form-control" 
        id="ports" 
        name="ports" 
        required
        placeholder="HDMI, DisplayPort, USB-C"
        value="<%= product ? product.ports : '' %>"
      >
    </div>

    <!-- Описание -->
    <div class="col-12">
      <label class="form-label" for="desc">Описание</label>
      <textarea 
        class="form-control" 
        id="desc" 
        name="desc" 
        rows="4"
        required
      ><%= product ? product.desc : '' %></textarea>
    </div>

    <!-- Цена -->
    <div class="col-4">
      <label class="form-label" for="price">Цена</label>
      <input 
        class="form-control" 
        id="price" 
        name="price" 
        type="number" 
        min="0" 
        step="0.01"
        required
        value="<%= product ? product.price : '' %>"
      >
    </div>

    <!-- Фото -->
    <div class="col-12">
      <label class="form-label" for="pic">URL картинки</label>
      <input 
        class="form-control" 
        id="pic" 
        name="pic"
        value="<%= product ? product.pic : '/img/pic.png' %>"
      >
      <div class="mt-2">
        <img 
          id="picPreview" 
          src="<%= product ? product.pic : '/img/pic.png' %>" 
          width="140" 
          class="border rounded"
          style="object-fit: cover"
        >
      </div>
    </div>

  </div>

  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary" type="submit">Сохранить</button>
    <a class="btn btn-outline-secondary" href="/">Отмена</a>
  </div>
</form>

<script>
  // Живая превью картинки
  const picInput = document.getElementById('pic');
  const preview = document.getElementById('picPreview');

  picInput.addEventListener('input', () => {
    const url = picInput.value.trim();
    preview.src = url || '/img/pic.png';
  });
</script>

<%- include('partials/footer') %>
